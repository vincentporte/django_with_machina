{% load i18n %}
{% load mptt_tags %}
{% load forum_tags %}
{% load forum_conversation_tags %}
{% load forum_member_tags %}
{% load forum_tracking_tags %}

<div class="row">
    <div class="col-12">
        {% if forum_contents.nodes %}
            {% recurseforumcontents forum_contents %}
                {% if node.level == root_level %}
                    {% if node.obj.is_category %}
                        <div class="mt-3 card forumlist">
                            <div class="p-0 card-header">
                                <div class="row m-0 px-3 py-2">
                                    <div class="pl-0 col-md-8 col-sm-9 col-12 forum-name-col">
                                        <h3 class="m-0 card-title h5"><a href="{% url 'forum:forum' node.obj.slug node.obj.id %}" class="text-dark">{{ node.obj.name }}</a></h3>
                                    </div>

                                </div>
                            </div>
                            <div class="p-0 card-body">
                                {{ children }}
                            </div>
                        </div>
                    {% else %}
                        {% with node.previous_sibling.obj as previous_sibling %}
                            {% if previous_sibling and previous_sibling.is_category or not previous_sibling in forum_contents.visible_forums or not previous_sibling %}
                                <div class="mt-3 card forumlist">

                                    <div class="p-0 card-body">
                            {% endif %}
                        {% endwith %}
                        <div class="row m-0 px-3 py-2 border-bottom">
                            {% if not node.obj.is_link %}
                                <div class="pl-0 col-md-7 col-sm-9 col-11 forum-name">
                                    <table class="forum-data-table">
                                        <tr>
                                            <td class="pt-1 pr-3 align-top forum-icon {% if node.obj in unread_forums %}unread{% endif %}">
                                                <i class="far fa-circle fa-2x"></i>
                                            </td>
                                            <td>
                                                {% if node.obj.image %}
                                                    <td>
                                                        <div class="d-none d-md-block forum-image pr-2">
                                                            <img src="{{ node.obj.image.url }}" alt="{{ node.obj.name }}" />
                                                        </div>
                                                    </td>
                                                {% endif %}
                                                <td class="align-top">
                                                    <a href="{% url 'forum:forum' node.obj.slug node.obj.id %}" class="forum-name-link">{{ node.obj.name }}</a>
                                                    <div class="forum-description">{{ node.obj.description.rendered }}</div>
                                                    <div class="sub-forums"><small>{{ children }}</small></div>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>

                            {% else %}
                                <div class="pl-0 col-md-8 col-sm-9 col-11 forum-name" colspan="2">
                                    <table class="forum-data-table">
                                        <tr>
                                            <td class="pt-1 pr-3 align-top forum-icon link"><i class="fas fa-link fa-2x"></i></td>
                                            <td class="align-top">
                                                <a href="{% url 'forum:forum' node.obj.slug node.obj.id %}" class="forum-name-link">{{ node.obj.name }}</a>
                                                <div class="forum-description">{{ node.obj.description.rendered }}</div>
                                            </td>
                                        </tr>
                                    </table>
                                </div>

                            {% endif %}
                        </div>
                        {% with node.next_sibling.obj as next_sibling %}
                            {% if next_sibling and next_sibling.is_category or not next_sibling in forum_contents.visible_forums or not next_sibling %}
                                </div>
                                </div>
                            {% endif %}
                        {% endwith %}
                    {% endif %}
                {% elif node.level == root_level_middle %}
                    {% if node.parent.obj.is_category %}
                        <div class="row m-0 px-3 py-2 border-bottom">
                            {% if not node.obj.is_link %}
                                <div class="pl-0 col-md-7 col-sm-9 col-11 forum-name">
                                    <table class="forum-data-table">
                                        <tr>
                                            <td class="pt-1 pr-3 align-top forum-icon {% if node.obj in unread_forums %}unread{% endif %}"><i class="far fa-circle fa-2x"></i></td>
                                            {% if node.obj.image %}
                                                <td>
                                                    <div class="d-none d-md-block forum-image pr-2">
                                                        <img src="{{ node.obj.image.url }}" alt="{{ node.obj.name }}" />
                                                    </div>
                                                </td>
                                            {% endif %}
                                            <td class="align-top">
                                                <a href="{% url 'forum:forum' node.obj.slug node.obj.id %}" class="forum-name-link">{{ node.obj.name }}</a>
                                                <div class="forum-description">{{ node.obj.description.rendered }}</div>
                                                <div class="sub-forums"><small>{{ children }}</small></div>
                                            </td>
                                        </tr>
                                    </table>
                                </div>

                            {% else %}
                                <div class="pl-0 col-md-8 col-sm-9 col-11 forum-name" colspan="2">
                                    <table class="forum-data-table">
                                        <tr>
                                            <td class="pt-1 pr-3 align-top forum-icon link"><i class="fas fa-link fa-2x"></i></td>
                                            <td class="align-top">
                                                <a href="{% url 'forum:forum' node.obj.slug node.obj.id %}" class="forum-name-link">{{ node.obj.name }}</a>
                                                <div class="forum-description">{{ node.obj.description.rendered }}</div>
                                            </td>
                                        </tr>
                                    </table>
                                </div>

                            {% endif %}
                        </div>
                    {% else %}
                        {% if not node.previous_sibling %}

                        {% endif %}
                        <i class="fas fa-file"></i>&nbsp;<a href="{% url 'forum:forum' node.obj.slug node.obj.id %}">{{ node.obj.name }}</a>&nbsp;&nbsp;
                    {% endif %}
                {% elif node.level == root_level_sub %}
                    {% if not node.previous_sibling %}

                    {% endif %}
                    <i class="fas fa-file"></i>&nbsp;<a href="{% url 'forum:forum' node.obj.slug node.obj.id %}">{{ node.obj.name }}</a>&nbsp;&nbsp;
                {% endif %}
            {% endrecurseforumcontents %}
        {% else %}
            {% trans "No forums." %}
        {% endif %}
    </div>
</div>
